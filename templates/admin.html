{% extends 'base.html' %}
{% block content %}
  <h2>Admin Dashboard</h2>
  <div class="stats">
    <div class="stat">Total today: {{ total_today }}</div>
    <div class="stat">Approved today: {{ approved_today }}</div>
    <div class="stat">Pending: {{ pending }}</div>
    <div class="stat">Revenue Today: E{{ revenue_today }}</div>
  </div>
  <p><a href="{{ url_for('admin_logout') }}">Logout</a></p>
  <table class="table">
    <thead><tr><th>Date</th><th>Time</th><th>Customer</th><th>Service</th><th>Paid</th><th>Status</th><th>Technician</th><th>Actions</th></tr></thead>
    <tbody>
      {% for b in bookings %}
        <tr id="b{{ b.id }}">
          <td>{{ b.date }}</td>
          <td>{{ b.time }}</td>
          <td>{{ b.customer_name }}<br>{{ b.phone }}</td>
          <td>{{ b.service }}</td>
          <td>{{ 'Yes' if b.paid else 'No' }}</td>
          <td class="status">{{ b.status }}</td>
          <td>{{ b.technician or '-' }}</td>
          <td>
            <form method="post" action="{{ url_for('admin_action', bid=b.id) }}" style="display:inline">
              <input type="hidden" name="action" value="approve">
              <input type="text" name="technician" placeholder="Assign tech (optional)">
              <button class="btn small" type="submit" {% if b.status=='approved' %}disabled{% endif %}>Approve</button>
            </form>
            <form method="post" action="{{ url_for('admin_action', bid=b.id) }}" style="display:inline">
              <input type="hidden" name="action" value="reject">
              <button class="btn small" type="submit" {% if b.status=='rejected' %}disabled{% endif %}>Reject</button>
            </form>
            <form method="post" action="{{ url_for('admin_action', bid=b.id) }}" style="display:inline">
              <input type="hidden" name="action" value="complete">
              <button class="btn small" type="submit" {% if b.status=='completed' %}disabled{% endif %}>Complete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
